apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: archive-ingress
  namespace: archive
  annotations:
    # NCP ALB 설정
    ncloud.com/load-balancer-type: APPLICATION
    
    # CORS 설정 (모바일 앱을 위해)
    ncloud.com/cors-allow-origin: "*"
    ncloud.com/cors-allow-methods: "GET,POST,PUT,DELETE,OPTIONS"
    ncloud.com/cors-allow-headers: "Content-Type,Authorization,X-Requested-With"
    
    # Health Check 설정
    ncloud.com/health-check-path: "/actuator/health"
    ncloud.com/health-check-interval: "30"
    ncloud.com/health-check-timeout: "5"
    ncloud.com/health-check-healthy-threshold: "2"
    ncloud.com/health-check-unhealthy-threshold: "2"
    ncloud.com/health-check-response-code: "200"
    
    # 기타 설정
    ncloud.com/load-balancer-protocol: HTTP
    ncloud.com/target-type: ip

spec:
  ingressClassName: alb
  rules:
  - http:
      paths:
      # API 엔드포인트
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: archive-api-service
            port:
              number: 8080
      
      # Swagger UI (개발/테스트용)
      - path: /swagger-ui
        pathType: Prefix
        backend:
          service:
            name: archive-api-service
            port:
              number: 8080
      
      # API 문서
      - path: /v3/api-docs
        pathType: Prefix
        backend:
          service:
            name: archive-api-service
            port:
              number: 8080
      
      # Health Check
      - path: /actuator
        pathType: Prefix
        backend:
          service:
            name: archive-api-service
            port:
              number: 8080
      
      # 루트 경로도 API로 라우팅 (필요시)
      - path: /
        pathType: Prefix
        backend:
          service:
            name: archive-api-service
            port:
              number: 8080
